
# Data cleaning function
def clean_ranking_data(rank_str):
    if isinstance(rank_str, str):
        digits = [int(s) for s in rank_str.split() if s.isdigit()]
        return digits[0] if digits else None
    return None

# Applying the cleaning function to the ranking data
cleaned_rankings_df = df[model_columns].applymap(clean_ranking_data)

# Re-adding the category column to the cleaned rankings dataframe
cleaned_rankings_df['category'] = df['category']

# Function to determine the highest and lowest ranking category for each model
def get_best_worst_categories_corrected(df, model_name):
    # Grouping by category and calculating the mean ranking for the model
    category_rankings = df.groupby('category')[model_name].mean()

    # Finding the category with the highest and lowest average ranking
    best_category = category_rankings.idxmin()
    worst_category = category_rankings.idxmax()

    return best_category, worst_category

# Applying the function to each model with the corrected dataframe
best_worst_categories_corrected = {model: get_best_worst_categories_corrected(cleaned_rankings_df, model) for model in model_columns}

# The final output
best_worst_categories_corrected
